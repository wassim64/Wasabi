<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Choropleth Map by Genre</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        .country {
            stroke: #fff;
            stroke-width: 0.5px;
        }
        .legend {
            font-size: 12px;
        }
        /* Style pour centrer et espacer la barre de sélection */
        .controls {
            text-align: center;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="controls">
    <label for="genreChoice">Select Genre:</label>
    <select id="genreChoice" onchange="updateMap()">
        <option value="Soul">Soul</option>
        <option value="Melodic Death Metal">Melodic Death Metal</option>
        <option value="Disco">Disco</option>
        <option value="Alternative Hip Hop">Alternative Hip Hop</option>
        <option value="Avant-garde Metal">Avant-garde Metal</option>
        <option value="Teen Pop">Teen Pop</option>
        <option value="Pop">Pop</option>
        <option value="Hip Hop">Hip Hop</option>
        <option value="Screamo">Screamo</option>
        <option value="Country">Country</option>
        <option value="Acoustic">Acoustic</option>
        <option value="Grindcore">Grindcore</option>
        <option value="Progressive Rock">Progressive Rock</option>
        <option value="Jazz">Jazz</option>
        <option value="Reggae">Reggae</option>
        <option value="Brutal Death Metal">Brutal Death Metal</option>
        <option value="Rock">Rock</option>
        <option value="Groove Metal">Groove Metal</option>
        <option value="Post-Punk">Post-Punk</option>
        <option value="Thrash Metal">Thrash Metal</option>
        <option value="Christian Rock">Christian Rock</option>
        <option value="Heavy Metal">Heavy Metal</option>
        <option value="Synthpop">Synthpop</option>
        <option value="Indie Rock">Indie Rock</option>
        <option value="Black Metal">Black Metal</option>
        <option value="Sludge Metal">Sludge Metal</option>
        <option value="Europop">Europop</option>
        <option value="Hardcore Punk">Hardcore Punk</option>
        <option value="Progressive Metal">Progressive Metal</option>
        <option value="Punk Rock">Punk Rock</option>
        <option value="Piano Rock">Piano Rock</option>
        <option value="Gothic Metal">Gothic Metal</option>
        <option value="Jazz Fusion">Jazz Fusion</option>
        <option value="Power Metal">Power Metal</option>
        <option value="Funk Melody">Funk Melody</option>
        <option value="Math Rock">Math Rock</option>
        <option value="Experimental Rock">Experimental Rock</option>
        <option value="Folk">Folk</option>
        <option value="Indie Pop">Indie Pop</option>
        <option value="Post-Hardcore">Post-Hardcore</option>
        <option value="Neofolk">Neofolk</option>
        <option value="Speed Metal">Speed Metal</option>
        <option value="Dance-Pop">Dance-Pop</option>
        <option value="Hard Rock">Hard Rock</option>
        <option value="Contemporary Christian">Contemporary Christian</option>
        <option value="Funk">Funk</option>
        <option value="New Wave">New Wave</option>
        <option value="Electronic Rock">Electronic Rock</option>
        <option value="Pop Rock">Pop Rock</option>
        <option value="Psychedelic Rock">Psychedelic Rock</option>
        <option value="MPB">MPB</option>
        <option value="Children's Music">Children's Music</option>
        <option value="Classical">Classical</option>
        <option value="Melodic Metalcore">Melodic Metalcore</option>
        <option value="Pop Punk">Pop Punk</option>
        <option value="Industrial Metal">Industrial Metal</option>
        <option value="Doom Metal">Doom Metal</option>
        <option value="Street Punk">Street Punk</option>
        <option value="Death Metal">Death Metal</option>
        <option value="Alternative Rock">Alternative Rock</option>
        <option value="Deathcore">Deathcore</option>
        <option value="Metalcore">Metalcore</option>
        <option value="EBM">EBM</option>
        <option value="Gospel">Gospel</option>
        <option value="Christmas">Christmas</option>
        <option value="Symphonic Black Metal">Symphonic Black Metal</option>
        <option value="Dark Wave">Dark Wave</option>
        <option value="Folk Rock">Folk Rock</option>
        <option value="K-Pop">K-Pop</option>
        <option value="Industrial Rock">Industrial Rock</option>
        <option value="Industrial">Industrial</option>
        <option value="Emo">Emo</option>

    </select>
</div>


    <svg width="960" height="600"></svg>

    <script>
        const width = 1200,  // Largeur du SVG
        height = 800;  // Hauteur du SVG

        const svg = d3.select("svg")
              .attr("width", width)
              .attr("height", height);

        // Utiliser une projection Mercator et ajuster l'échelle et la translation pour centrer
        const projection = d3.geoMercator()
                     .scale(150) // Ajustez l'échelle si nécessaire pour remplir le SVG
                     .translate([width / 2, height / 1.5]); // Centrez la carte

        const path = d3.geoPath().projection(projection);

        // Échelle de couleur pour la carte
        const colorScale = d3.scaleSequential(d3.interpolateBlues).domain([0, 50]);

        let choroplethData;

        // Charger les données de la carte et des genres
        Promise.all([
            d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson"),
            fetch("http://127.0.0.1:5000/choropleth-data").then(response => response.json())
        ]).then(([mapData, data]) => {
            choroplethData = data;
            svg.selectAll("path")
               .data(mapData.features)
               .enter().append("path")
               .attr("d", path)
               .attr("class", "country")
               .style("fill", d => colorScale(0)); // Couleur initiale

            updateMap();
        });

        function updateMap() {
            const selectedGenre = document.getElementById("genreChoice").value;

            svg.selectAll(".country")
               .transition()
               .duration(500)
               .style("fill", d => {
                   const country = d.properties.name;
                   const genreCount = choroplethData[country] ? choroplethData[country][selectedGenre] || 0 : 0;
                   return genreCount > 0 ? colorScale(genreCount) : "#e0e0e0";
               });
        }
    </script>
</body>
</html>
